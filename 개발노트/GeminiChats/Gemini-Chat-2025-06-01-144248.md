from selenium import webdriver
from selenium.webdriver.chrome.service import Service
from selenium.webdriver.common.by import By
import os
import time
from datetime import datetime

SAVE_DIR = r"D:\백업폴더\OneDrive\Gemini Chat backup"
os.makedirs(SAVE_DIR, exist_ok=True)
timestamp = datetime.now().strftime("GeminiChat-%Y-%m-%d-%H%M%S.txt")
save_path = os.path.join(SAVE_DIR, timestamp)

# 요청하신 경로로 수정
CHROMEDRIVER_PATH = r"D:\download\chromedriver-win64\chromedriver-win64\chromedriver.exe"
CHROME_BINARY_PATH = r"D:\download\chrome-win64\chrome.exe"

options = webdriver.ChromeOptions()
options.binary_location = CHROME_BINARY_PATH

print("크롬 드라이버 준비 중...")
try:
    driver = webdriver.Chrome(service=Service(CHROMEDRIVER_PATH), options=options)
except Exception as e:
    print("크롬 드라이버 실행 오류:", e)
    input("엔터를 눌러 종료")
    exit(1)

try:
    print("Gemini 접속 중...")
    driver.get("https://gemini.google.com/app")
    input("로그인 및 원하는 대화창을 띄운 뒤 엔터를 누르세요...")

    while True:
        print("대화 내용 추출 시도 중...")
        time.sleep(5)
        chat_elements = driver.find_elements(By.CSS_SELECTOR, ".markdown, .ProseMirror, .message-content, .text-content")
        chats = [elem.text for elem in chat_elements if elem.text.strip()]
        print(f"추출된 메시지 개수: {len(chats)}")
        if chats:
            with open(save_path, "w", encoding="utf-8") as f:
                for chat in chats:
                    f.write(chat + "\n\n")
            print(f"[{datetime.now().strftime('%H:%M:%S')}] 대화 내용 자동 저장 완료: {save_path}")
        else:
            print("대화 내용을 찾지 못했습니다.")
        time.sleep(60)
except Exception as e:
    print("오류:", e)
finally:
    driver.quit()