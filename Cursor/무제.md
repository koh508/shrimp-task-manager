
# 옵시디언에서 원드라이브 파일 보기 (코딩 방식)

다음은 옵시디언에서 원드라이브 파일을 직접 볼 수 있는 간단한 HTML 파일과 스크립트입니다. 초등학생도 따라할 수 있게 상세히 설명해드리겠습니다.

## 1단계: 필요한 파일 만들기

1. 메모장 열기 
2. 아래 코드를 복사해서 붙여넣기:

```html
<!DOCTYPE html>
<html>
<head>
    <title>원드라이브 파일 보기</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        button { padding: 10px; background: #0078d4; color: white; border: none; border-radius: 5px; cursor: pointer; }
        input { padding: 8px; width: 300px; }
        #fileList { margin-top: 20px; }
        .file-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .file-item:hover { background-color: #f5f5f5; }
        #viewer { margin-top: 20px; border: 1px solid #ddd; min-height: 400px; padding: 10px; }
    </style>
</head>
<body>
    <h1>우리집 원드라이브 파일</h1>
    
    <button id="loginButton">마이크로소프트 계정으로 로그인</button>
    <div id="userInfo" style="display:none;">
        <p>로그인 됨: <span id="userName"></span></p>
        <button id="logoutButton">로그아웃</button>
    </div>
    
    <div id="searchBox" style="display:none; margin-top: 20px;">
        <input type="text" id="searchInput" placeholder="찾고 싶은 파일 이름 입력...">
        <button id="searchButton">검색</button>
    </div>
    
    <div id="fileList"></div>
    <div id="viewer"></div>

    <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js"></script>
    <script>
        // Microsoft 인증 설정
        const msalConfig = {
            auth: {
                clientId: "여기에_클라이언트_ID_입력",
                authority: "https://login.microsoftonline.com/common",
                redirectUri: window.location.origin + window.location.pathname,
            }
        };

        const msalInstance = new msal.PublicClientApplication(msalConfig);
        let account = null;
        let accessToken = null;

        // 로그인 버튼
        document.getElementById('loginButton').addEventListener('click', async () => {
            try {
                const loginResponse = await msalInstance.loginPopup({
                    scopes: ["Files.Read", "Files.Read.All", "User.Read"]
                });
                
                account = loginResponse.account;
                await getAccessToken();
                await loadUserInfo();
                
                document.getElementById('loginButton').style.display = 'none';
                document.getElementById('userInfo').style.display = 'block';
                document.getElementById('searchBox').style.display = 'block';
                
                // 파일 목록 불러오기
                await listFiles();
            } catch (error) {
                alert("로그인 중 오류가 발생했습니다: " + error);
            }
        });

        // 로그아웃 버튼
        document.getElementById('logoutButton').addEventListener('click', () => {
            msalInstance.logout();
        });

        // 검색 버튼
        document.getElementById('searchButton').addEventListener('click', async () => {
            await searchFiles(document.getElementById('searchInput').value);
        });

        // 엔터키로 검색
        document.getElementById('searchInput').addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                await searchFiles(document.getElementById('searchInput').value);
            }
        });

        // 액세스 토큰 가져오기
        async function getAccessToken() {
            try {
                const tokenResponse = await msalInstance.acquireTokenSilent({
                    scopes: ["Files.Read", "Files.Read.All", "User.Read"],
                    account: account
                });
                accessToken = tokenResponse.accessToken;
            } catch (error) {
                console.error("토큰 가져오기 오류:", error);
                try {
                    const tokenResponse = await msalInstance.acquireTokenPopup({
                        scopes: ["Files.Read", "Files.Read.All", "User.Read"]
                    });
                    accessToken = tokenResponse.accessToken;
                } catch (err) {
                    alert("로그인 세션이 만료되었습니다. 다시 로그인해주세요.");
                    msalInstance.logout();
                }
            }
        }

        // 사용자 정보 가져오기
        async function loadUserInfo() {
            if (!accessToken) await getAccessToken();
            
            try {
                const response = await fetch("https://graph.microsoft.com/v1.0/me", {
                    headers: {
                        "Authorization": `Bearer ${accessToken}`
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    document.getElementById('userName').textContent = user.displayName;
                }
            } catch (error) {
                console.error("사용자 정보 가져오기 오류:", error);
            }
        }

        // 파일 목록 가져오기
        async function listFiles() {
            if (!accessToken) await getAccessToken();
            
            try {
                const response = await fetch("https://graph.microsoft.com/v1.0/me/drive/root/children", {
                    headers: {
                        "Authorization": `Bearer ${accessToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayFiles(data.value);
                }
            } catch (error) {
                console.error("파일 목록 가져오기 오류:", error);
            }
        }

        // 파일 검색하기
        async function searchFiles(searchTerm) {
            if (!accessToken) await getAccessToken();
            if (!searchTerm) {
                await listFiles();
                return;
            }
            
            try {
                const response = await fetch(`https://graph.microsoft.com/v1.0/me/drive/root/search(q='${searchTerm}')`, {
                    headers: {
                        "Authorization": `Bearer ${accessToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayFiles(data.value);
                }
            } catch (error) {
                console.error("파일 검색 오류:", error);
            }
        }

        // 파일 목록 표시하기
        function displayFiles(files) {
            const fileListElement = document.getElementById('fileList');
            fileListElement.innerHTML = "<h2>파일 목록</h2>";
            
            if (files.length === 0) {
                fileListElement.innerHTML += "<p>파일이 없습니다.</p>";
                return;
            }
            
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                // 아이콘 선택
                let icon = "📄";
                if (file.folder) icon = "📁";
                else if (file.name.endsWith('.jpg') || file.name.endsWith('.png')) icon = "🖼️";
                else if (file.name.endsWith('.docx')) icon = "📝";
                else if (file.name.endsWith('.xlsx')) icon = "📊";
                else if (file.name.endsWith('.pdf')) icon = "📑";
                
                fileItem.innerHTML = `${icon} ${file.name}`;
                
                // 폴더인 경우
                if (file.folder) {
                    fileItem.addEventListener('click', async () => {
                        await openFolder(file.id);
                    });
                } 
                // 파일인 경우
                else {
                    fileItem.addEventListener('click', async () => {
                        await viewFile(file);
                    });
                }
                
                fileListElement.appendChild(fileItem);
            });
        }

        // 폴더 열기
        async function openFolder(folderId) {
            if (!accessToken) await getAccessToken();
            
            try {
                const response = await fetch(`https://graph.microsoft.com/v1.0/me/drive/items/${folderId}/children`, {
                    headers: {
                        "Authorization": `Bearer ${accessToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    displayFiles(data.value);
                }
            } catch (error) {
                console.error("폴더 열기 오류:", error);
            }
        }

        // 파일 보기
        async function viewFile(file) {
            const viewer = document.getElementById('viewer');
            viewer.innerHTML = `<h3>${file.name} 내용</h3>`;
            
            // 이미지인 경우
            if (file.name.endsWith('.jpg') || file.name.endsWith('.png') || file.name.endsWith('.gif')) {
                await getAccessToken();
                const downloadUrl = file['@microsoft.graph.downloadUrl'];
                viewer.innerHTML += `<img src="${downloadUrl}" style="max-width:100%">`;
            }
            // PDF인 경우
            else if (file.name.endsWith('.pdf')) {
                await getAccessToken();
                const downloadUrl = file['@microsoft.graph.downloadUrl'];
                viewer.innerHTML += `<iframe src="${downloadUrl}" width="100%" height="500px"></iframe>`;
            }
            // 문서 파일인 경우
            else if (file.name.endsWith('.docx') || file.name.endsWith('.xlsx') || file.name.endsWith('.pptx')) {
                viewer.innerHTML += `
                    <p>이 파일은 현재 뷰어에서 직접 볼 수 없습니다.</p>
                    <button id="downloadBtn">다운로드</button>
                `;
                document.getElementById('downloadBtn').addEventListener('click', () => {
                    window.open(file['@microsoft.graph.downloadUrl']);
                });
            }
            // 텍스트 파일인 경우
            else if (file.name.endsWith('.txt')) {
                try {
                    await getAccessToken();
                    const response = await fetch(file['@microsoft.graph.downloadUrl']);
                    if (response.ok) {
                        const text = await response.text();
                        viewer.innerHTML += `<pre>${text}</pre>`;
                    }
                } catch (error) {
                    console.error("텍스트 파일 보기 오류:", error);
                }
            }
            // 기타 파일
            else {
                viewer.innerHTML += `
                    <p>이 파일 형식은 지원하지 않습니다.</p>
                    <button id="downloadBtn">다운로드</button>
                `;
                document.getElementById('downloadBtn').addEventListener('click', () => {
                    window.open(file['@microsoft.graph.downloadUrl']);
                });
            }
        }
    </script>
</body>
</html>
```

3. 파일을 "원드라이브뷰어.html"로 저장하기

## 2단계: 마이크로소프트 앱 등록하기 (한 번만 하면 됨)

1. 인터넷 브라우저에서 [https://portal.azure.com](https://portal.azure.com) 열기
2. 마이크로소프트 계정으로 로그인 (원드라이브 계정)
3. "앱 등록" 검색하고 클릭
4. "새 등록" 버튼 클릭
5. 이름에 "원드라이브뷰어" 입력
6. 리디렉션 URI에 "http://localhost:8080/원드라이브뷰어.html" 입력
7. "등록" 버튼 클릭
8. 생성된 "애플리케이션(클라이언트) ID" 복사하기

## 3단계: HTML 파일 수정하기

1. 저장한 "원드라이브뷰어.html" 파일을 메모장으로 다시 열기
2. "여기에_클라이언트_ID_입력" 부분을 찾아서 복사한 ID로 바꾸기
3. 파일 저장하기

## 4단계: 간단한 웹 서버 실행하기

1. 간단한 웹 서버 다운로드: [https://github.com/ritwickdey/vscode-live-server](https://github.com/ritwickdey/vscode-live-server)에서 Live Server 확장 프로그램 다운로드
2. 또는 Python이 설치되어 있다면 명령 프롬프트에서:
   - "원드라이브뷰어.html" 파일이 있는 폴더로 이동
   - `python -m http.server 8080` 명령 실행

## 5단계: 옵시디언에 연결하기

1. 옵시디언 열기
2. 새 노트 만들기
3. 아래 내용 추가:
```markdown
# 원드라이브 파일 보기

<iframe src="http://localhost:8080/원드라이브뷰어.html" width="100%" height="700px"></iframe>
```

4. 저장하기

## 사용 방법

1. 웹 서버 실행하기
2. 옵시디언에서 만든 노트 열기
3. "마이크로소프트 계정으로 로그인" 버튼 클릭
4. 팝업 창에서 로그인
5. 원드라이브 파일 목록이 표시됨
6. 파일을 클릭하면 내용이 보임
7. 검색창에 파일 이름 입력해서 찾기 가능

이 방법을 사용하면 플러그인 없이도 원드라이브 파일을 옵시디언에서 직접 볼 수 있습니다!
